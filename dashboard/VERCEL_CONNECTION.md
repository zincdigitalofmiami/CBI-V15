# Vercel Connection Guide

This document describes how the CBI-V15 dashboard connects to Vercel and MotherDuck.

## Project Structure

```
dashboard/
├── .vercel/
│   └── project.json      # Vercel project link config
├── .env.local            # Local environment variables (gitignored)
├── lib/
│   └── motherduck.ts     # MotherDuck WASM client connection utility
└── next.config.ts        # COOP/COEP headers for WASM support
```

## Vercel Configuration

| Property | Value |
|----------|-------|
| Project Name | `cbi-v15` |
| Project ID | `prj_n0UhCozV2HUrIp2dxKmuUSb0bkAx` |
| Team | `zincdigitalofmiamis-projects` |
| Production URL | https://web-steel-eight-62.vercel.app |

## Environment Variables

### Required for MotherDuck
- `motherduck_storage_MOTHERDUCK_TOKEN` - Read/write token
- `motherduck_storage_MOTHERDUCK_READ_SCALING_TOKEN` - Read scaling token

### Auto-generated by Vercel
- `VERCEL_OIDC_TOKEN` - OIDC token for Vercel integrations

## Troubleshooting

### Project Not Linked

If you see errors about missing `.vercel/project.json`:

```bash
cd dashboard
vercel link --yes --project cbi-v15
vercel env pull --yes
```

### Missing Environment Variables

Pull latest from Vercel:

```bash
cd dashboard
vercel env pull --yes
```

### MotherDuck Connection Fails

1. Check tokens are set in `.env.local`
2. Verify `next.config.ts` has COOP/COEP headers
3. Ensure `@motherduck/wasm-client` is installed

### Auth0 Issues

The `@auth0/nextjs-auth0@4.x` SDK has a different API than v3. If you see `handleAuth` errors:

- v3 used `handleAuth()` 
- v4 requires different setup with environment variables

### Build Fails

```bash
cd dashboard
npm install
npm run build
```

Check for:
- Missing dependencies
- TypeScript errors
- Import path issues

## Deployment

### Manual Deploy
```bash
cd dashboard
vercel
```

### Production Deploy
```bash
cd dashboard
vercel --prod
```

### GitHub Integration
Push to `main` branch triggers automatic deployment.

## Related Files

- [Terraform IaC](../infrastructure/vercel/README.md)
- [MotherDuck utility](./lib/motherduck.ts)
- [Next.js config](./next.config.ts)
